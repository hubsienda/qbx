<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather Guess Game</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f7f7f7; text-align:center; padding:20px; }
    h1 { color:#333; }
    .city-btn { margin:5px; padding:10px 15px; border:1px solid #ccc; border-radius:6px; cursor:pointer; background:#fff; }
    #result { margin-top:20px; font-size:1.3em; font-weight:bold; }
    #debug { margin-top:30px; font-size:0.8em; white-space:pre; text-align:left; background:#eee; padding:10px; border-radius:6px; max-width:700px; margin-left:auto; margin-right:auto; }
  </style>
</head>
<body>
  <h1>Weather Guess Game 🌍</h1>
  <p>Pick a city, guess the weather, then check if you beat the AI!</p>

  <div id="cities"></div>

  <div id="guessArea" style="margin-top:20px; display:none;">
    <button class="city-btn" onclick="makeGuess('Sunny')">☀️ Sunny</button>
    <button class="city-btn" onclick="makeGuess('Cloudy')">☁️ Cloudy</button>
    <button class="city-btn" onclick="makeGuess('Rainy')">🌧️ Rainy</button>
    <button class="city-btn" onclick="makeGuess('Snowy')">❄️ Snowy</button>
    <button class="city-btn" onclick="makeGuess('Stormy')">⛈️ Stormy</button>
    <button class="city-btn" onclick="makeGuess('Foggy')">🌫️ Foggy</button>
  </div>

  <div id="result">Idle. Click a city.</div>

  <details id="debug"><summary>Debug Panel</summary><div id="debugOut"></div></details>

  <p style="margin-top:40px;font-size:0.8em;">
    Powered by <a href="https://www.weatherapi.com/" title="Weather API">WeatherAPI.com</a>
  </p>

<script>
var API_KEY = "553b39e4a880493f8fe80855252108";
var currentCity = null;
var actualCat = null;

var CITIES = [
  "Rome, Italy","London, United Kingdom","Madrid, Spain","Paris, France",
  "Berlin, Germany","Tokyo, Japan","New York, USA","Ottawa, Canada",
  "Sydney, Australia","Moscow, Russia","Beijing, China","Seoul, South Korea",
  "Cairo, Egypt","Delhi, India","Bangkok, Thailand","Mexico City, Mexico",
  "Buenos Aires, Argentina","Nairobi, Kenya","Cape Town, South Africa","Athens, Greece"
];

// Build city buttons
var citiesDiv = document.getElementById("cities");
CITIES.forEach(c=>{
  var b=document.createElement("button");
  b.textContent=c;
  b.className="city-btn";
  b.onclick=()=>fetchWeather(c);
  citiesDiv.appendChild(b);
});

// Mapping codes → categories
function mapToCat(code) {
  code = parseInt(code, 10);

  if (code === 1087 || (code >= 1273 && code <= 1282)) return 'Stormy'; // Thunder
  if (code === 1063) return 'Rainy';
  if (code >= 1150 && code <= 1171) return 'Rainy'; // drizzle
  if (code >= 1180 && code <= 1201) return 'Rainy'; // rain
  if (code >= 1240 && code <= 1246) return 'Rainy'; // showers
  if (code === 1066 || code === 1069) return 'Snowy';
  if (code === 1114 || code === 1117) return 'Snowy';
  if (code >= 1204 && code <= 1207) return 'Snowy'; // sleet
  if (code >= 1210 && code <= 1237) return 'Snowy'; // snow
  if (code >= 1249 && code <= 1264) return 'Snowy'; // ice/sleet
  if (code === 1030 || code === 1135 || code === 1147) return 'Foggy'; // fog
  if (code === 1003 || code === 1006 || code === 1009) return 'Cloudy';
  if (code === 1000) return 'Sunny';
  return 'Cloudy';
}

function fetchWeather(city) {
  currentCity = city;
  document.getElementById("result").textContent = "Fetching weather for " + city + "...";
  document.getElementById("guessArea").style.display="block";

  var url = "https://api.weatherapi.com/v1/current.json"
    + "?key=" + encodeURIComponent(API_KEY)
    + "&q=" + encodeURIComponent(city)
    + "&aqi=no"
    + "&_=" + Date.now(); // cache-buster

  fetch(url).then(r=>r.json()).then(j=>{
    var code = j.current.condition.code;
    var text = j.current.condition.text;
    actualCat = mapToCat(code);
    document.getElementById("debugOut").textContent =
      "City: "+city+"\nCondition: "+text+" (code "+code+")\nMapped category: "+actualCat+"\n\nFull JSON:\n"+JSON.stringify(j,null,2);
    document.getElementById("result").textContent = "Now guess the weather in " + city + "!";
  }).catch(e=>{
    document.getElementById("result").textContent="Error: "+e;
  });
}

function makeGuess(g) {
  if(!actualCat){document.getElementById("result").textContent="Pick a city first!";return;}
  if(g===actualCat){
    document.getElementById("result").textContent="🎉 Correct! It really is "+g+" in "+currentCity+"!";
  } else {
    document.getElementById("result").textContent="❌ Wrong! You guessed "+g+", but it's "+actualCat+" in "+currentCity+".";
  }
}
</script>
</body>
</html>

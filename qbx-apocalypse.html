<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Apocalypse Generator â€” QBX Labs</title>
<meta name="description" content="Click to generate a brand-new apocalypse with British humour. PG mode by default. Share a permalink and make your mates panic (lightly).">
<style>
  :root{
    --bg:#0b0b0c; --ink:#f5f5f6; --muted:#b6b6ba; --card:#141417; --br:#232328;
    --btn:#111113; --btnh:#1c1c20; --accent:#8b5cf6; --ok:#22c55e;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.55 system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif}
  .wrap{max-width:980px;margin:0 auto;padding:24px}
  h1{font-size:clamp(26px,6vw,42px);margin:0 0 6px}
  .lead{color:var(--muted);margin:0 0 16px}
  .panel{background:var(--card);border:1px solid var(--br);border-radius:16px;padding:16px;margin:14px 0}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  label.small{font-size:13px;color:var(--muted);display:flex;gap:8px;align-items:center}
  input[type="checkbox"]{transform:translateY(1px)}
  button{cursor:pointer;border-radius:12px;border:1px solid #2b2b31;background:var(--btn);color:var(--ink);padding:10px 14px;font-weight:700}
  button.primary{background:var(--accent);border-color:var(--accent)}
  button:hover{filter:brightness(1.06)}
  .out{font-size:clamp(18px,2.4vw,22px);background:#0f0f12;border:1px dashed #3a3a42;border-radius:14px;padding:16px;min-height:140px;line-height:1.55}
  .small{font-size:13px;color:var(--muted)}
  .status{margin-left:auto}
  .cite{font-size:13px;color:#9aa;opacity:.95;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸŒğŸ’¥ Apocalypse Generator</h1>
  <p class="lead">Click to summon a brand-new end of the world. PG mode by default; British humour throughout.</p>

  <section class="panel">
    <div class="row" style="justify-content:space-between">
      <div class="row">
        <button id="gen" class="primary">âœ¨ Generate</button>
        <button id="copy">ğŸ“‹ Copy</button>
        <button id="tweet">ğŸ¦ Tweet</button>
        <button id="slack">ğŸ’¬ Open Slack</button>
        <button id="link">ğŸ”— Copy share link</button>
      </div>
      <label class="small"><input id="pg" type="checkbox" checked> PG mode</label>
      <span id="status" class="small status">Ready.</span>
    </div>

    <div id="out" class="out">Your apocalypse will appear here. Ideally before tea.</div>
    <div id="source" class="cite"></div>
  </section>

  <p class="small">Disclaimer: this is satire. No doom, only gloom with giggles. Keep it kind; no hate, no real harm.</p>
</div>

<script>
// ===== Utilities (ES5) =====
function pick(a, rng){ return a[Math.floor(rng()*a.length)]; }

// Simple seeded RNG (LCG) for deterministic shares
function makeRNG(seed){
  var m=0x80000000, a=1103515245, c=12345;
  var state = (seed>>>0) || Math.floor(Date.now()%m);
  return function(){ state=(a*state+c)%m; return state/m; };
}
function parseHash(){
  // #s=12345&pg=1
  var h = (location.hash||'').replace(/^#/, '');
  var obj = {};
  if(!h) return obj;
  var parts = h.split('&');
  for(var i=0;i<parts.length;i++){
    var kv = parts[i].split('=');
    obj[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1]||'');
  }
  return obj;
}
function setStatus(s){ document.getElementById('status').textContent = s; }

// ===== Content banks (PG by default; â€œspicyâ€ stays safe & non-graphic) =====
var BANK = {
  when: [
    "next Tuesday, right after lunch",
    "the moment someone says â€œitâ€™s just a quick meetingâ€",
    "precisely at tea time",
    "as Mercury retrogrades for dramatic effect",
    "the instant a group chat hits 100 unread messages",
    "when the Wi-Fi flickers thrice",
    "at 03:07, because the apocalypse keeps odd hours",
    "during the annual office fire drill that nobody takes seriously"
  ],
  type_pg: [
    "a perfectly polite minor apocalypse",
    "a bureaucracy-induced meltdown",
    "a global calendar sync failure",
    "a spontaneous mass nap",
    "a civilisation-wide kettle shortage",
    "an outbreak of unstoppable small talk",
    "a planet-scale spreadsheet crash",
    "a universal â€˜Reply-Allâ€™ incident"
  ],
  type_spicy: [
    "a mildly chaotic vending-machine uprising",
    "a paperwork avalanche of biblical admin",
    "a dignified stampede towards the biscuit aisle",
    "a dramatic shortage of functioning chargers",
    "a polite but firm takeover by pigeons",
    "an unstoppable wave of corporate jargon",
    "a city-wide invasion of rubber ducks",
    "a lunar-powered tidal meeting that never ends"
  ],
  cause_pg: [
    "someone pressed â€˜Update Allâ€™ on a Friday",
    "the calendar decided every day is Monday",
    "the to-do list achieved sentience and quit",
    "a weather app became emotionally unavailable",
    "autocorrect began enforcing the Oxford comma with force",
    "a spreadsheet mistook 2025 for 1900",
    "everyone clicked â€˜Remind me laterâ€™ forever",
    "an alarm clock unionised and demanded naps"
  ],
  cause_spicy: [
    "the coffee supply chain became decaf only",
    "printers discovered collective bargaining",
    "smart fridges formed a chilled council",
    "pigeons cracked two-factor authentication",
    "escalators reversed out of spite",
    "keyboards started charging per vowel",
    "AI assistants booked meetings with themselves",
    "routers escaped into the countryside"
  ],
  twist_pg: [
    "â€¦and yet nobody is late, somehow",
    "â€¦but the sun arrives with a written apology",
    "â€¦while all plants provide motivational quotes",
    "â€¦and spontaneous bake sales restore morale",
    "â€¦but every error comes with a biscuit",
    "â€¦and the moon agrees to dim slightly for ambience",
    "â€¦yet the trains run exactly on time, suspiciously",
    "â€¦and everyone gets the day off, contractually"
  ],
  twist_spicy: [
    "â€¦and rubber ducks seize parliamentâ€”peacefully",
    "â€¦but cats assume managerial positions",
    "â€¦and every email arrives marked â€˜urgentâ€™ forever",
    "â€¦while Wi-Fi bars become a tradable currency",
    "â€¦and all meetings require interpretive dance",
    "â€¦but every phone only speaks in haiku",
    "â€¦and keyboards demand paid holidays",
    "â€¦while printers appoint themselves auditors"
  ],
  solution_pg: [
    "Put the kettle on; reboot society; try again.",
    "Issue biscuits at scale; proceed calmly.",
    "A brisk walk and a sternly worded post-it note.",
    "Universal nap time followed by organised chaos.",
    "Switch it off and on again (the usual).",
    "Queue politely until civilisation resets.",
    "Reassign blame to Mercury; carry on.",
    "Deploy tea. Lots of tea."
  ],
  solution_spicy: [
    "Offer the pigeons cabinet positions; negotiate snacks.",
    "Bribe the printers with premium paper.",
    "Appoint a cat as interim CTO; accept purring.",
    "Pay the rubber ducks in bath time.",
    "Introduce a biscuit-backed currency.",
    "Mandate five-minute meetings by law.",
    "Replace buzzwords with charades.",
    "Turn it off and on again, but with jazz."
  ],
  sources: [
    "Journal of Improbable Events (2025)",
    "Proceedings of the Global Biscuit Council",
    "Quarterly Review of Mild Catastrophes",
    "International Almanac of Silly Predictions",
    "Royal Society of Tea-Based Solutions",
    "Institute for Advanced Faffing"
  ]
};

// Build one scenario from a RNG + mode
function buildScenario(rng, pgMode){
  var type = pgMode ? pick(BANK.type_pg, rng) : pick(BANK.type_spicy, rng);
  var cause = pgMode ? pick(BANK.cause_pg, rng) : pick(BANK.cause_spicy, rng);
  var twist = pgMode ? pick(BANK.twist_pg, rng) : pick(BANK.twist_spicy, rng);
  var fix   = pgMode ? pick(BANK.solution_pg, rng) : pick(BANK.solution_spicy, rng);
  var when  = pick(BANK.when, rng);
  var src   = pick(BANK.sources, rng);

  var lines = [];
  lines.push("On " + when + ", " + type + " begins when " + cause + ".");
  lines.push("The twist: " + twist);
  lines.push("The only sensible response: " + fix);
  return { text: lines.join(" "), source: "Source: " + src };
}

// ===== DOM =====
var out = document.getElementById('out');
var source = document.getElementById('source');
var genBtn = document.getElementById('gen');
var copyBtn = document.getElementById('copy');
var tweetBtn = document.getElementById('tweet');
var slackBtn = document.getElementById('slack');
var linkBtn = document.getElementById('link');
var pgChk = document.getElementById('pg');

// State
var lastSeed = null;
var lastText = "";

// Generate + render
function generate(seed){
  var pgMode = !!pgChk.checked;
  var s = (typeof seed==='number') ? seed : Math.floor(Date.now() % 0x7fffffff);
  var rng = makeRNG(s);
  var scenario = buildScenario(rng, pgMode);
  lastSeed = s;
  lastText = scenario.text + "\n" + scenario.source;

  out.textContent = scenario.text;
  source.textContent = scenario.source;

  // Update URL hash for shareable permalink
  var hash = "#s=" + encodeURIComponent(String(s)) + "&pg=" + (pgMode?1:0);
  if(location.hash !== hash){ history.replaceState(null,"",hash); }
  setStatus("Generated â€¢ share link updated.");
}

genBtn.addEventListener('click', function(){ generate(); });

// Copy
copyBtn.addEventListener('click', function(){
  if(!lastText){ setStatus("Nothing to copy yet."); return; }
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(lastText).then(function(){ setStatus("Copied to clipboard."); })
      .catch(function(){ setStatus("Clipboard blocked â€” select and copy manually."); });
  }else{
    setStatus("Clipboard unsupported â€” select and copy manually.");
  }
});

// Tweet
tweetBtn.addEventListener('click', function(){
  var msg = lastText || "Summoning a brand-new apocalypse at QBX Labs.";
  var url = location.href.split('#')[0] + (location.hash||"");
  var t = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(msg) + "&url=" + encodeURIComponent(url) + "&hashtags=QBXLabs,ApocalypseGenerator";
  window.open(t, "_blank");
});

// Slack
slackBtn.addEventListener('click', function(){
  window.open("https://app.slack.com/client", "_blank");
});

// Share link
linkBtn.addEventListener('click', function(){
  var u = location.href.split('#')[0] + (location.hash||"");
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(u).then(function(){ setStatus("Share link copied."); })
      .catch(function(){ setStatus("Clipboard blocked â€” copy from the address bar."); });
  }else{
    setStatus("Copy from the address bar.");
  }
});

// Load from hash if present
(function(){
  var h = parseHash();
  if(h.s){
    var seed = parseInt(h.s, 10);
    if(!isNaN(seed)){ pgChk.checked = (String(h.pg||'1')==='1'); generate(seed); return; }
  }
  // First run, fresh
  generate();
})();
</script>
</body>
</html>

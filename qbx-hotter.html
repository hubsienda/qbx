<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hotter City â€” QBX Labs</title>
  <meta name="description" content="Pick which of two world cities is hotter right now. Temps reveal after your guess.">

  <!-- Canonical -->
  <link rel="canonical" href="https://weather.qbx.app/#hottercity">

  <!-- Open Graph / Twitter -->
  <meta property="og:url" content="https://weather.qbx.app/#hottercity">
  <meta property="og:title" content="Hotter City â€” QBX Labs">
  <meta property="og:description" content="Pick which of two world cities is hotter right now. Temps reveal after your guess.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://raw.githubusercontent.com/hubsienda/qbx/refs/heads/main/og-weather.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Global Share Bar -->
  <script src="https://hubsienda.github.io/qbx/qbx-share.js" defer></script>

  <style>
    :root{
      --bg:#fdfdfd; --ink:#111; --muted:#666; --panel:#fff; --br:#e6e6e6;
      --accent:#ff007f; --hover:#f0f0f0; --btn:#111; --btn-ink:#fff;
    }
    *{box-sizing:border-box}
    body {
      font-family: system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;
      text-align: center; background: var(--bg); padding: 40px; color: var(--ink);
    }
    h1 { color: var(--accent); margin: 0 0 6px; font-size: clamp(26px,5vw,40px); }
    p.lead { color: var(--muted); margin: 0 0 18px; }
    .panel {
      max-width: 720px; margin: 0 auto; background: var(--panel);
      border:1px solid var(--br); border-radius:16px; padding:20px;
    }
    #cities { display:flex; gap:16px; justify-content:center; flex-wrap:wrap; min-height:120px; align-items:center; }
    .city {
      display: inline-block; min-width: 180px;
      margin: 6px; padding: 18px 20px; font-size: 20px; font-weight: 800;
      background: #eee; border-radius: 12px; cursor: pointer;
      transition: background .2s ease, transform .06s ease; user-select: none;
    }
    .city:hover { background: var(--hover); transform: translateY(-1px); }
    .city.disabled { opacity: .6; pointer-events: none; }
    #result { margin-top: 18px; font-size: 18px; font-weight: 700; color: #333; min-height: 1.6em; }
    .small { font-size: 13px; color: var(--muted); }
    .row { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; align-items:center; margin-top: 12px; }
    button {
      cursor: pointer; border-radius: 12px; border: 1px solid #2b2b31;
      background: var(--btn); color: var(--btn-ink); padding: 10px 14px; font-weight: 700;
    }
    button:hover{ filter: brightness(1.06); }
  </style>
</head>
<body>

  <h1>ðŸ”¥ Hotter City</h1>
  <p class="lead">Which city is hotter right now? Pick one â€” weâ€™ll reveal the temps after your guess.</p>

  <section class="panel">
    <div id="cities">Loadingâ€¦</div>
    <div id="result"></div>
    <div class="row">
      <button id="nextBtn" style="display:none">Next round âŸ²</button>
      <span id="status" class="small">Ready.</span>
    </div>

    <!-- Share bar mount -->
    <div id="qbx-share-bar" style="margin-top:14px"></div>
  </section>

  <script>
    const API_KEY = "553b39e4a880493f8fe80855252108";
    const CITIES = [
      "Rome","London","Madrid","Paris","Berlin","Tokyo","New York","Sydney","Cairo","Dubai",
      "Athens","Istanbul","Toronto","Mexico City","Sao Paulo","Johannesburg","Singapore","Bangkok","Delhi","Jakarta"
    ];

    const $ = (id) => document.getElementById(id);
    const citiesEl = $("cities");
    const resultEl = $("result");
    const statusEl = $("status");
    const nextBtn = $("nextBtn");

    function setStatus(t){ statusEl.textContent = t; }

    async function getTemperature(city) {
      const url = `https://api.weatherapi.com/v1/current.json?key=${API_KEY}&q=${encodeURIComponent(city)}&aqi=no`;
      const res = await fetch(url);
      if(!res.ok) throw new Error("Network error " + res.status);
      const data = await res.json();
      if(!data || !data.current || typeof data.current.temp_c !== "number"){
        throw new Error("Bad response for " + city);
      }
      return data.current.temp_c;
    }

    function pickTwoDistinct(arr){
      const idx1 = Math.floor(Math.random()*arr.length);
      let idx2 = Math.floor(Math.random()*arr.length);
      while(idx2 === idx1){ idx2 = Math.floor(Math.random()*arr.length); }
      return [arr[idx1], arr[idx2]];
    }

    let round = null;

    async function newRound(){
      resultEl.textContent = "";
      nextBtn.style.display = "none";
      setStatus("Fetching live temperaturesâ€¦");
      citiesEl.innerHTML = "Loadingâ€¦";

      const [city1, city2] = pickTwoDistinct(CITIES);

      try{
        const [t1, t2] = await Promise.all([ getTemperature(city1), getTemperature(city2) ]);
        round = { c1: city1, c2: city2, t1: t1, t2: t2, locked: false };

        citiesEl.innerHTML = "";
        citiesEl.appendChild(makeCityButton(city1, () => makeGuess(city1)));
        citiesEl.appendChild(makeCityButton(city2, () => makeGuess(city2)));

        setStatus("Make your choice.");
      }catch(err){
        citiesEl.innerHTML = "";
        resultEl.textContent = "Sorry, we couldnâ€™t fetch weather data just now.";
        setStatus("Error: " + (err && err.message ? err.message : "unknown"));
        nextBtn.style.display = "inline-block";
      }
    }

    function makeCityButton(name, onClick){
      const div = document.createElement("div");
      div.className = "city";
      div.textContent = name;
      div.addEventListener("click", onClick);
      return div;
    }

    function makeGuess(chosenCity){
      if(!round || round.locked) return;
      round.locked = true;

      const items = citiesEl.querySelectorAll(".city");
      items.forEach(el => el.classList.add("disabled"));

      const { c1, c2, t1, t2 } = round;
      const otherCity = (chosenCity === c1) ? c2 : c1;
      const chosenTemp = (chosenCity === c1) ? t1 : t2;
      const otherTemp = (chosenCity === c1) ? t2 : t1;

      let text = "";
      if (chosenTemp > otherTemp) {
        text = `âœ… Correct! ${chosenCity} is hotter: ${chosenTemp.toFixed(1)}Â°C vs ${otherCity} ${otherTemp.toFixed(1)}Â°C.`;
      } else if (chosenTemp < otherTemp) {
        text = `âŒ Not quite! ${otherCity} is hotter: ${otherTemp.toFixed(1)}Â°C vs ${chosenCity} ${chosenTemp.toFixed(1)}Â°C.`;
      } else {
        text = `ðŸ¤· Itâ€™s a tie! Both ${chosenCity} and ${otherCity} are ${chosenTemp.toFixed(1)}Â°C.`;
      }
      resultEl.textContent = text;

      const [btn1, btn2] = citiesEl.querySelectorAll(".city");
      if(btn1 && btn2){
        btn1.textContent = `${c1} â€” ${t1.toFixed(1)}Â°C`;
        btn2.textContent = `${c2} â€” ${t2.toFixed(1)}Â°C`;
      }

      nextBtn.style.display = "inline-block";
      setStatus("Round complete.");

      // Update share bar with last round
      if(window.QBXShare){
        QBXShare.update(
          "I just played Hotter City â€” " + text,
          "https://weather.qbx.app/#hottercity"
        );
      }
    }

    nextBtn.addEventListener("click", newRound);

    newRound();

    // Init share bar once
    document.addEventListener("DOMContentLoaded", function(){
      if(window.QBXShare){
        QBXShare.init({
          mountId:'qbx-share-bar',
          getMessage:function(){ return "Play Hotter City at QBX Labs â€” guess which city is hotter right now!"; },
          getURL:function(){ return "https://weather.qbx.app/#hottercity"; },
          accent:'#00cc00',
          show:{copy:true,twitter:true,whatsapp:true,link:true}
        });
      }
    });
  </script>

</body>
</html>
